<form [formGroup]="vendaForm" (ngSubmit)="onSubmit()">
  <div class="mt-3">
    <p-panel [toggleable]="true" [collapsed]="isCollapsed">
      <ng-template pTemplate="header">
        <div>
          <span class="font-bold">Detalhes da Venda</span>
        </div>
      </ng-template>
      <div class="grid">
        <div class="p-fluid col-12 md:col-4">
          <div class="flex flex-column gap-2">
            <label for="cliente">Cliente</label>
            <p-dropdown id="cliente" [options]="clientes" formControlName="cliente" optionLabel="nome"
                        placeholder="Selecione um cliente"></p-dropdown>
          </div>
        </div>

        <div class="p-fluid col-12 md:col-4">
          <div class="flex flex-column gap-2">
            <label for="servico">Serviço</label>
            <p-dropdown id="servico" [options]="servico" formControlName="servico" optionLabel="nome"
                        placeholder="Selecione um serviço" optionValue="valor" filter="true"
                        filterPlaceholder="Pesquisar serviço"></p-dropdown>
          </div>
        </div>

        <div class="p-fluid col-12 md:col-4">
          <div class="flex flex-column gap-2">
            <label for="status">Status</label>
            <p-dropdown id="status" [options]="status" formControlName="status" optionLabel="nome"
                        placeholder="Selecione um status" optionValue="valor" filter="true"
                        filterPlaceholder="Pesquisar status"></p-dropdown>
          </div>
        </div>



        <div class="p-fluid col-12 md:col-6">
          <div class="flex flex-column gap-2">
            <label for="dataEmbarque">Data de Embarque</label>
            <input pInputText id="dataEmbarque" type="date" formControlName="dataEmbarque"/>
          </div>
        </div>

        <div class="p-fluid col-12 md:col-6">
          <div class="flex flex-column gap-2">
            <label for="dataDesembarque">Data de Desembarque</label>
            <input pInputText id="dataDesembarque" type="date" formControlName="dataDesembarque"/>
          </div>
        </div>

        <div class="p-fluid col-12 md:col-6">
          <div class="flex flex-column gap-2">
            <label for="origem">Origem</label>
            <input pInputText id="origem" formControlName="origem"/>
          </div>
        </div>

        <div class="p-fluid col-12 md:col-6">
          <div class="flex flex-column gap-2">
            <label for="destino">Destino</label>
            <input pInputText id="destino" formControlName="destino"/>
          </div>
        </div>


      </div>
    </p-panel>


  </div>

  <ng-container *ngIf="vendaId">
    <div class="mt-3">
      <p-panel [toggleable]="true" [collapsed]="hasItems">
        <ng-template pTemplate="header">
          <div>
            <span class="font-bold">Itens da Venda</span>
          </div>
        </ng-template>
        <p-table [value]="vendaForm.get('itens').value" styleClass="p-datatable-striped" responsiveLayout="stack"
                 [tableStyle]="{ 'min-width': '50rem' }">
          <ng-template pTemplate="header">
            <tr>
              <th>Nome</th>
              <th>Preço</th>
              <th>Descrição</th>
              <th>Ações</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-item>
            <tr>
              <td>{{ item.produto.nome }}</td>
              <td>{{ item.produto.preco }}</td>
              <td>{{ item.produto.descricao }}</td>
              <td>
                <button aria-label="editar" (click)="onEdit(item.id)" pButton style="margin: 0 5px;"
                        icon="pi pi-pencil" pTooltip="Editar">
                </button>
                <!-- <button aria-label="excluir" pButton style="margin: 0 5px;" icon="pi pi-trash"
                    (click)="onRemove(venda.id)" pTooltip="Excluir" tooltipPosition="top">
                </button> -->
              </td>
            </tr>
          </ng-template>
        </p-table>
      </p-panel>
    </div>

    <div class="mt-3">
      <p-panel [toggleable]="true" [collapsed]="attachmentColapsed">
        <ng-template pTemplate="header">
          <div>
            <span class="font-bold">Anexos</span>
          </div>
        </ng-template>
        <p-fileUpload name="arquivo" [url]="uploadUrl" (onUpload)="onUpload($event)" [multiple]="false"
                      maxFileSize="1000000" [auto]="true" chooseLabel="Enviar">
          <ng-template pTemplate="content">
            <ul *ngIf="uploadedFiles.length">
              <li *ngFor="let file of uploadedFiles">
                <div class="flex gap-1 align-items-center mt-1">
                  <span class="font-bold">{{ file.name }}</span>
                  <p-button [text]="true" icon="fa-solid fa-file-arrow-down" (click)="onDownload(file.id)"
                            pTooltip="Download"></p-button>
                  <p-button [text]="true" severity="danger" icon="fa-solid fa-trash" (click)="onRemove(file.id)"
                            pTooltip="Remover"></p-button>
                </div>
              </li>
            </ul>
          </ng-template>
        </p-fileUpload>

      </p-panel>
    </div>
  </ng-container>

  <div class="mt-3 flex flex-row-reverse gap-3">
    <button pButton (click)="goBack()" severity="secondary" type="button" label="Voltar"></button>
    <button pButton [disabled]="vendaForm.invalid" type="submit" [label]="vendaId ? 'Atualizar' : 'Cadastrar'"></button>
  </div>
</form>
